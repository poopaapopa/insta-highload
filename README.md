# **Instagram**
Instagram - глобальная социальная сеть для обмена фотографиями и видео.

## 1. **Тема и целевая аудитория**

### **Аналитика аудитории**

*   **Пользователей:** более 2 млрд в месяц (MAU).

*   **Визиты на сайт:** 6.11 млрд в месяц.

*   **Демография:** 52.5% мужчин и 47.5% женщин.

*   **Основной возраст:** от 18 до 34 лет.

<img width="450" height="400" alt="Снимок экрана 2026-02-19 193230" src="https://github.com/user-attachments/assets/1f9aabe7-5fd1-4984-a1f9-92b3f45a0916" />

*   **Устройства:** 43.65% с персонального компьютера, 56.35% с мобильного устройства.

<img width="200" alt="image" src="https://github.com/user-attachments/assets/d2201ca8-4339-4b09-90bb-72a50d13f8bc" />

*   **Страны:** Особо выделяются США, Бразилия и Индия. Остальные места в списке стран варьируются в зависимости от года.

<img width="600" alt="image" src="https://github.com/user-attachments/assets/b53f9d15-cf2e-411f-bbd1-7d7af97c0046" />

<img width="805" height="889" alt="image" src="https://github.com/user-attachments/assets/b2dd2b13-9f8f-402a-b361-ac7674d30c66" />

### Функциональность MVP
1.   Регистрация и авторизация с возможностью кастомизировать профиль.
2.   Лента с рекомендациями.
3.   Stories - исчезающий контент 24 часа.
5.   Direct - обмен сообщениями.
6.   Комментарии под постами.
7.   Подписки на аккаунты пользователей.
8.   Возможность публиковать посты.
9.   Лайки постов.
10.  Поиск.

### Продуктовые фичи
1.   AR - Создание контента с фильтрами и масками.

### Список источников
1.  **[Semrush (Overview)](https://www.semrush.com/website/instagram.com/overview/)** - Устройства, визиты и страны.
2.  **[Statista](https://www.statista.com/topics/1882/instagram/#statisticChapter)** - Демография и посещаемость (MAU).

## 2. **Расчёт нагрузки**

Так как Meta не публикует технические отчеты о точной емкости своих дата-центров и детальном распределении типов файлов, я опираюсь на исторические данные, инженерные стандарты сжатия и маркетинговые исследования. За основу взяты данные за 2019-2021 годы. Сейчас данные изменились, но я решил основываться на более точной информации и избежать рассмотрения, тогда ещё никому неизвестных, **Reels**

* MAU (Monthly Active Users): **2 000 000 000 (2 млрд.)** - [*Источник:*](https://www.statista.com/statistics/253577/number-of-monthly-active-instagram-users/)

* Stories daily active users: **500 000 000 (500 млн.)** - [*Источник:*](https://www.statista.com/statistics/730315/instagram-stories-daily-active-users/)

* "**95 million** photos and videos are shared on Instagram every day" - [*Источник:*](https://www.wordstream.com/blog/ws/2017/04/20/instagram-statistics)

* "**500 million** accounts use Instagram Stories every day" - [*Источник:*](https://www.wordstream.com/blog/ws/2017/04/20/instagram-statistics)

* "**40 billion** photos and videos have been shared on the Instagram platform since its conception" - [*Источник:*](https://www.wordstream.com/blog/ws/2017/04/20/instagram-statistics)

* "The least active 25% of brands publish just **over 1 Story** per week." - Я использовал эти цифры по 25% наименее часто постящим истории брендам как в среднем по историям активных пользователей - [*Источник:*](https://www.rivaliq.com/blog/instagram-stories-benchmark-report/)

<img width="350" height="197" alt="image" src="https://github.com/user-attachments/assets/a9b7f81a-16b0-4a4d-9a29-ec82f66d39da" />

* "В августе 2016 года Instagram запустил Instagram Stories" - **5 лет** существуют на момент 2021-ого года истории в Instagram - [*Источник:*](https://ru.wikipedia.org/wiki/Instagram)

* Возьмём средний вес картинки разрешения 1920×1080 в широко используемом для хранения формате wemp как **0.35 МБ**

* Для Stories Возьмём средний вес видео разрешения 1920×1080 30 FPS в формате webm максимальной в Instagram длины 15 секунд как **5,35 МБ** - [*Рассчитано в*](https://storedbits.com/video-bitrate-calculator/)

* Для постов возьмём средний вес видео разрешения 1920×1080 30 FPS в формате webm средней в постах длины 30 секунд как **10,7 МБ** - [*Рассчитано в*](https://storedbits.com/video-bitrate-calculator/)

* Соотношение контента в постах - [*Источник*](https://www.quintly.com/blog/instagram-study-2019)

<img width="600" height="400" alt="image" src="https://github.com/user-attachments/assets/1df8a75a-3794-4fd7-bfc1-725ac388a5d2" />

* Исходя из данных можно высчитать среднее количество слайдов постов-каруселей как (2×0.331)+(3×0.197)+(4×0.146)+(10×0.068)+(7×0.258) = **4.32**. Тогда учитывая средний размер видео и фото и соотношение видео и фото в этих постах можно вычислить средний размер таких постов как (1.51×0.888)+(55.9×0.04)+(14.15×0.073) = **4.61 Мбайт** [*Источник*](https://www.marketingcharts.com/digital/social-media-114405)

* Лимит сообщений в инстаграм **20 в день** для новосозданных аккаунтов - [*Источник*](https://sendpulse.com/ru/blog/limits-on-instagram)

* "The average personal account on Instagram has **264 followers**." - [*Источник*](https://sqmagazine.co.uk/instagram-followers-statistics)

* "Average Comments per post in Instagram - **20**" - [*Источник*](https://www.socialinsider.io/social-media-benchmarks)

* "The Instagram “like” button is hit an average of **4.2 billion** times per day." - [*Источник*](https://www.mysocialmotto.com/instagram-statistics-every-social-media-marketer-needs-to-know/)​

### Средний размер хранилища на пользователя

| Объект | Средний размер на пользователя | Логика расчета и формулы |
| :--- | :--- | :--- |
| **Stories** | **376.2 Мбайт** | **(2 млрд. / 6 млрд.) × 6.6 сторис/месяц × 12 месяцев × 5 лет × 2.85 Мбайт**<br>1. *Активность:* 2 млрд. активных в месяц из ~6 млрд. зарегистрированных (каждый 3-й).<br>2. *Частота:* Активный автор создает ~6.6 сторис в месяц.<br>3. *Вес:* Среднее между видео-сторис (5.35 МБ) и фото (0.35 МБ) = **2.85 МБ**.<br>4. *Итого:* 99 сторис × 2.85 МБ. |
| **Посты** | **56.16 Мбайт** | **(40 млрд постов / 2 млрд юзеров) = 20 постов**<br>1. *Сотношение:* 68% фото (18 шт), 18% видеои 14% посты-карусели (2 шт).<br>2. *Фото:* 20 × 0.68 × 0.35 Мбайт = **4.76 Мбайт**.<br>3. *Видео:* 20 × 0.18 × 10.7 Мбайт = **38.52 Мбайт**.<br>3. *Карусели:* 20 × 0.14 × 4.6 Мбайт = **12.88 Мбайт**.<br>4. *Итого:* 4.76 + 38.52 + 12.88 = 56.16 Мбайт. |
| **Сообщения (Direct)** | **267.33 Мбайт** | Расчет на 36.5 тыс. сообщений (20 в день × 365 дней × 5 лет). Допустим, что 90% сообщений - это текст. Оставшиеся 10% - это медиа: фото (100 КБ), голосовые (250 КБ) и GIF (200 КБ). Тогда каждое сообщение ~30Кбайт. Учитывая что активен каждый 4-ый пользователь получаем 36.5 × 30Кбайт × 0.25 |
| **Профиль** | **0.55 Мбайт** | **Аватар + Био + Обложки**<br>1. *Аватар:* 3 версии (1080px, 320px, 150px) ≈ **0.5 Мбайт**.<br>2. *Highlights:* 5 обложек (150 px webp) × 10 Кбайт = **0.05 Мбайт**.<br>3. *Био:* Текст (150 символов UTF-8) ≈ максимум 2 Кбайт (пренебрежимо мало). |
| **Лайки** | **0.35 Мбайт** | **4.2 млрд./день / 500млн. пользователей/день × 365 дней × 5 лет × 24 Байта**. Хранятся в графовой базе данных TAO [Meta Engineering](https://engineering.fb.com/2013/06/25/core-infra/tao-the-power-of-the-graph/) в виде ребер графа (User_ID + Post_ID + Time), занимая всего 24 байта на запись. |
| **Комментарии** | **11.7 Мбайт** | **20 постов × 20 комм./пост × 30 Кбайт**<br> Возьмём такой же размер у каждого комментария как и у сообщения т.к. туда можно отправлять те же форматы. |
| **Подписки** | **6.19 Кбайт** | **264 подписок × 24 Байта**<br>Хранятся как ребра графа в выше упомянутой БД TAO: `Source_ID` (8b) + `Target_ID` (8b) + `Time` (8b). |
| **Итого** | **~618.25 Мбайт** | **Stories и Direct занимают ~88% всего места. Посты ~9%. Комментарии ~1.5%. Остальные записи <1%** |

### Общий размер хранилища

Рассчитано путем умножения среднего размера хранилища пользователя на примерное количестово зарегистрированных пользователей (6 млрд).

| Тип данных | Общий объем |
| :--- | :--- |
| **Stories** | **2.05 Эксабайта** |
| **Сообщения (Direct)** | **313.81 Пбайт** |
| **Посты** | **1.46 Эксабайта** |
| **Комментарии** | **65.38 Пбайт** |
| **Профиль** | **3.07 Пбайт** |
| **Лайки** | **1.96 Пбайт** |
| **Подписки** | **34.59 Тбайт** |
| **Итого** | **3.89 Эксабайта** |

### Сетевой трафик

* **42 минуты** пользователь проводит в среднем в Instagram - [*Источник*](https://vc.ru/dnative/2713616-srednee-vremya-v-sotssetyakh-vkontakte-telegram-instagram)

| Тип трафика | Суммарный (Тбит/сутки) | Средний (Тбит/с) | Пиковый (Тбит/с) | Логика расчёта |
| :--- | :--- | :--- | :--- | :--- |
| **Просмотр (Download)** | **3 595 200** | **41.61** | **208.05** | **42 мин \* вес 1 мин (21.4 Мбайт) \* DAU (500 млн)**<br>1. *Вес минуты:* 10.7 МБ (из данных для 30 сек поста) \* 2 = 21.4 МБ.<br>2. *Объем:* 500 млн DAU \* 42 мин \* 21.4 МБ = 449 400 Тбайт.<br>3. *В битах:* 449 400 \* 8 = 3 595 200 Тбит.<br>4. *Пик:* Средний \* 5. |
| **Загрузка (Upload)** | **4 416** | **0.051** | **0.255** | **(Посты + Stories) \* Средний вес / 86400**<br>1. *Посты:* 95 млн \* 2.81 МБ (взвешенный вес фото/видео/каруселей) = 267 Тбайт.<br>2. *Stories:* ~100 млн (допустим 20% от DAU публикуют контент) \* 2.85 МБ = 285 Тбайт.<br>3. *Итого:* 552 Тбайт \* 8 = 4416 Тбит. |

### РПС

Для пиковых значений брал **коэффициент 1.5** т.к. расположение по всему миру.

| Тип запроса | Средний RPS | Пиковый RPS | Логика расчёта |
| :--- | :--- | :--- | :--- |
| **Просмотр ленты / Stories** | **243 055** | **364 582** | **DAU \* (Время / 1 мин) / 86400**<br>Пользователь проводит 42 минуты. Делает 1 запрос к API (подгрузка контента/пагинация) в минуту.<br>*(500 млн \* 42) / 86400* |
| **Лайки** | **48 611** | **72 916** | **Total Likes / 86400**<br>4.2 млрд лайков в день.<br>*(4 200 000 000 / 86400)* |
| **Комментарии** | **21 990** | **32 985** | **Total Comments / 86400**<br>95 млн постов \* 20 комм. = 1.9 млрд/сутки.<br>*(1 900 000 000 / 86400)* |
| **Загрузка медиа** | **4 571** | **6 856** | **(Посты + Stories) / 86400**<br>95 млн постов + ~300 млн Stories = 395 млн загрузок.<br>*(395 000 000 / 86400)* |
| **Посещение профилей** | **28 935** | **43 402** | **DAU \* 5 профилей / 86400**<br>В среднем пользователь заходит на 5 профилей за сессию.<br>*(500 млн \* 5) / 86400* |
| **Авторизация** | **868** | **1 302** | **DAU \* 15% / 86400**<br>Только 15% пользователей проходят логин.<br>*(500 млн \* 0.15) / 86400* |
| **Регистрация** | **3.8** | **5.7** | **New Users / 86400**<br>Оценка: 10 млн новых регистраций в месяц (глобальный рост + боты).<br>*(10 000 000 / 30 дней) / 86400* |

### Прирост

| Тип данных | Количество/сутки | Вес 1 шт | Прирост (Тбайт/сутки) |
| :--- | :--- | :--- | :--- |
| **Stories** | 300 000 000 | 2.85 МБ | **855 Тбайт** |
| **Посты (Медиа)** | 95 000 000 | 2.81 МБ | **267 Тбайт** |
| **Сообщения (Direct)** | 5 000 000 000 | 30 КБ | **143 Тбайт** |
| **Комментарии** | 1 900 000 000 | 30 КБ | **54 Тбайт** |
| **Лайки** | 4 200 000 000 | 0.024 КБ | **0.1 Тбайт** |

| Период | Общий объем |
| :--- | :--- |
| **Сутки** | **~1 319 Тбайт** (1.32 Пбайт) |
| **Месяц** | **39 570 Тбайт** (39.6 Пбайт) |
| **Год** | **474 840 Тбайт** (475 Пбайт) |

## 3. **Глобальная балансировка**

#### 3.1 Домены

Instagram разделяет трафик на динамический (API) и статический (CDN) для оптимизации.

*   **Основной домен:** `i.instagram.com` (мобильный API), `www.instagram.com` (Web).
*   **CDN домены (Media):** `scontent.cdninstagram.com` (Фото/Видео). Используется Domain Sharding для обхода лимитов браузеров и гео-распределения.
*   **Graph API:** `graph.instagram.com` (Для сторонних разработчиков и бизнес-интеграций).

#### 3.2 Data Centers
Instagram — глобальный сервис с аудиторией 2+ млрд человек. В отличие от локальных сервисов, он требует размещения Origin-датацентров (где хранятся данные) на разных континентах.
Мы используем инфраструктуру Meta.

**Распределение трафика по регионам (на основе MAU):**

| Процент | Регион | Ключевые страны |
| :--- | :--- | :--- |
| **50%** | **Азиатско-Тихоокеанский (APAC)** | Индия (481м), Индонезия (108м) |
| **18%** | **Северная Америка (NA)** | США (181м), Мексика(53м) |
| **14%** | **Латинская Америка (LATAM)** | Бразилия (147м), Аргентина(31м) |
| **18%** | **Европа / MEA** | Турция(62м), UK(35м), Германия(31м) |

Исходя из кластеров пользователей, целесообразно использовать следующие центры основного хранения (помимо сети Edge PoP (кэширование)):

1.  **Ashburn, Virginia (США)** — Основной хаб мирового интернета - обслужит восточное побережье (80% населения Северной Америки).
2.  **Singapore (Сингапур)** — Хаб для Индии и Юго-Восточной Азии.
3.  **Dublin, Ireland (Европа)** — Европейский хаб.
4.  **Prineville, Oregon (США)** — Обслуживание западного побережья и Тихого океана.
5.  **São Paulo (Бразилия)** — Локальный хаб для Латинской Америки.

#### 3.3 Технологии глобальной балансировки

**DNS (Cartographer)**

Используем **Geo-DNS** ([**Cartographer** Meta](https://engineering.fb.com/2017/08/21/networking-traffic/steering-oceans-of-content-to-the-world/)) для направления пользователя на ближайший Edge Hub, а затем **Backbone Routing** для доставки запроса в Origin DC.

1.  Пользователь из Индии открывает приложение.
2.  Cartographer определяет, что пользователь находится в подсети определённого провайдера.
3.  Система знает, что сейчас маршрут до **Сингапура** перегружен, и направляет пользователя на Edge-ноду в **Мумбаи** (кэширующий прокси), которая по оптике соединена с Сингапуром.
4.  DNS возвращает IP ближайшей Edge-ноды.

При этом Edge отдает статику из локального кэша, а запрос API летит по внутренней оптике Meta в **Oregon DC (USA West)**.

**BGP Anycast**

Для обеспечения минимальной задержки и защиты от DDoS используем технологию **IP Anycast**.

Единый диапазон IP-адресов (например, для DNS-серверов и CDN-фронтов) анонсируется одновременно из всех PoP (точек присутствия) по протоколу BGP. → Глобальная сеть интернет автоматически направляет запрос пользователя к топологически ближайшему дата-центру (ользователь из Берлина → маршрутизируется в узел **Frankfurt Edge**.). В случае аварии в узле (например, Франкфурт недоступен), BGP-маршруты автоматически перестраиваются, и трафик из Берлина направляется в следующий ближайший узел (например, Амстердам) без необходимости изменения DNS-записей.

**Распределение нагрузки по ДЦ**

| Параметр | Общая нагрузка | Singapore (APAC) | Ashburn (NA East) | Dublin (EU) | Prineville (NA West) | São Paulo (LATAM) |
| :--- | :--- | :--- | :--- | :--- | :--- | :--- |
| **Доля** | **100%** | **42%** | **14%** | **18%** | **12%** | **14%** |
| **RPS** | **350,000** | 147,000 | 49,000 | 63,000 | 42,000 | 49,000 |
